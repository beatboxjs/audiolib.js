this.audioLib=function t(e,n,i,s){function r(t){r.list.push(t)}function a(t){var e=new q(t);return e.subarray=e.subarray||e.slice,e}function o(t,e,n,i){E?E(t,e,{get:function(){return n},enumerable:!!i}):t[e]=n}function u(t){var e,n,i=arguments,s=i.length;for(e=1;s>e;e++)for(n in i[e])i[e].hasOwnProperty(n)&&(t[n]=i[e][n]);return t}function f(t,e,n){var i;for(i in t)(t.hasOwnProperty(i)||n)&&e.call(t,t[i],i);return t}function h(t,e,n){var i,r;if(!n)if(n=[],i=/^\s*function\s*\w*\s*\(([^\)]+)/.exec(e))i[1].replace(/[a-z$_0-9]+/gi,function(t){n.push(t)});else for(i=0;i<e.length;i++)n[i]=s(i+2).join("_");return r=Function("var __q;return function "+t+"("+n.join()+"){var i; if(__q){__q=!__q}else if(this instanceof "+t+")this.__CLASSCONSTRUCTOR.apply(this,arguments);else{__q=!__q;i=new "+t+";i.__CLASSCONSTRUCTOR.apply(i,arguments);return i}};")(),r.prototype=e.prototype,r.prototype.__CLASSCONSTRUCTOR=e,u(r,e),r}function l(t,e,n,i){this.parameter=t,this.automation=e,this.amount=isNaN(n)?this.amount:n,this.setType(i)}function c(t,e,n,i,s){if(!t.automation)switch(t.automation=[],t.type){case"generator":t.append=c.generatorAppend;break;case"effect":t.append=c.effectAppend;break;case"buffereffect":t.append=c.bufferEffectAppend}return n=new l(e,n,i,s),t.automation.push(n),n}function p(t,e,n){function i(){t.apply(this,n)}for(this.channelCount=isNaN(e)?this.channelCount:e,this.effects=[],i.prototype=t.prototype;e--;)this.effects.push(new i)}function m(t,e){var n=t[0].toUpperCase()+t.substr(1).toLowerCase();return m[t]=e,e.decode&&(D.Sampler.prototype["load"+n]=function(e){this.load.apply(this,[m[t].decode(e)].concat([].slice.call(arguments,1)))}),e.encode&&(D.AudioDevice.Recording.prototype["to"+n]=function(e){return m[t].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:e})}),e}function d(){}function g(){}function v(t,e){v[t]=e,v._pluginList.push({plugin:e,name:t})}function y(t,e,n,i,s,r,a){this.sampleRate=isNaN(t)?this.sampleRate:t,this.attack=isNaN(e)?this.attack:e,this.decay=isNaN(n)?this.decay:n,this.sustain=isNaN(i)?this.sustain:i,this.release=isNaN(s)?this.release:s,this.sustainTime=isNaN(r)?null:r,this.releaseTime=isNaN(a)?null:a}function b(t,e,n,i){this.sampleRate=isNaN(t)?this.sampleRate:t,this.stepLength=isNaN(e)?this.stepLength:e,this.steps=n||[1,0],this.attack=isNaN(i)?this.attack:i}function w(t,e){this.sampleRate=isNaN(t)?this.sampleRate:t,this.schedule=[],this.reset(e)}function S(t,e,n,i,s,r){this.reset.apply(this,arguments)}function _(t,e){var i=this,s=0;i.sampleRate=t,i.resolution=e?n.pow(2,e-1):n.pow(2,7),i.pushSample=function(t){return s=n.floor(t*i.resolution+.5)/i.resolution},i.getMix=function(){return s}}function k(t,e,i,s){function r(){o=new a(.1*h.sampleRate),u=0;var t,e=o.length;for(t=0;e>t;t++)o[t]=0}var o,u,f,h=this;h.delayTime=e||30,h.depth=i||3,h.freq=s||.1,h.sampleRate=t,h.osc=new O(t,s),h.calcCoeff=r,h.pushSample=function(t){++u>=o.length&&(u=0),o[u]=t,h.osc.generate();var e=h.delayTime+h.osc.getMix()*h.depth;for(e*=h.sampleRate/1e3,e=u-n.floor(e);0>e;)e+=o.length;return f=o[e]},h.getMix=function(){return f},r()}function C(t,e,n,i){var s=this;s.sampleRate=t,s.buffer=new a(isNaN(e)?1200:e),s.bufferSize=s.buffer.length,s.feedback=isNaN(n)?s.feedback:n,s.damping=isNaN(i)?s.damping:i,s.invDamping=1-s.damping}function R(t,e,n){var i=this,s=0;i.sampleRate=t,i.scale=e||1,i.gain=isNaN(n)?.5:n,i.pushSample=function(t){return t/=i.scale,s=(1+i.gain)*t-i.gain*t*t*t},i.getMix=function(){return s}}function P(t,e){this.sampleRate=isNaN(t)?this.sampleRate:t,this.setParam("kernels",e||new a(1))}function N(t,e,n){var i=this;i.time=isNaN(e)?i.time:e,i.feedback=isNaN(n)?i.feedback:n,i.reset(t)}function x(t){var e=new A(t,720.484),i=new A(t,723.431),s=new A(t,1),r=0;this.gain=4,this.master=1,this.sampleRate=t,this.filters=[e,i,s],this.pushSample=function(t){return e.pushSample(t),r=e.getMix(1)*this.gain,r=n.atan(r)+r,r>.4?r=.4:-.4>r&&(r=-.4),i.pushSample(r),s.pushSample(i.getMix(0)),r=s.getMix(1)*this.master},this.getMix=function(){return r}}function B(t,e,n,i,s,r,a){var o=this;o.sampleRate=t,o.channelCount=isNaN(e)?o.channelCount:e,o.wet=isNaN(n)?o.wet:n,o.dry=isNaN(i)?o.dry:i,o.roomSize=isNaN(s)?o.roomSize:s,o.damping=isNaN(r)?o.damping:r,o.tuning=new B.Tuning(a||o.tuning),o.sample=function(){var t,e=[];for(t=0;t<o.channelCount;t++)e[t]=0;return e}(),o.CFs=function(){var t,e,n=[],i=[],s=o.tuning.combCount,r=o.damping*o.tuning.scaleDamping,a=o.roomSize*o.tuning.scaleRoom+o.tuning.offsetRoom,u=o.tuning.combTuning;for(e=0;e<o.channelCount;e++){for(t=0;s>t;t++)i.push(new D.CombFilter(o.sampleRate,u[t]+e*o.tuning.stereoSpread,a,r));n.push(i),i=[]}return n}(),o.numCFs=o.CFs[0].length,o.APFs=function(){var t,e,n=[],i=[],s=o.tuning.allPassCount,r=o.tuning.allPassFeedback,a=o.tuning.allPassTuning;for(e=0;e<o.channelCount;e++){for(t=0;s>t;t++)i.push(new B.AllPassFilter(o.sampleRate,a[t]+e*o.tuning.stereoSpread,r));n.push(i),i=[]}return n}(),o.numAPFs=o.APFs[0].length}function F(t,e){this.sampleRate=isNaN(t)?this.sampleRate:t,this.gain=isNaN(e)?this.gain:e}function A(t,e,i,s){function r(){a=2*c(n.PI*p(.25,h.cutoff/(2*h.samplerate))),o=p(2*(1-m(h.resonance,.25)),p(2,2/a-.5*a))}var a,o,u,f,h=this,l=[0,0,0,0],c=n.sin,p=n.min,m=n.pow;h.cutoff=isNaN(e)?2e4:e,h.resonance=i?i:.1,h.samplerate=isNaN(t)?44100:t,h.type=s||0,h.pushSample=function(t){return(u!==h.cutoff||f!==h.resonance)&&(r(),u=h.cutoff,f=h.resonance),l[3]=t-o*l[2],l[0]=l[0]+a*l[2],l[1]=l[3]-l[0],l[2]=a*l[1]+l[2],l[3]=t-o*l[2],l[0]=l[0]+a*l[2],l[1]=l[3]-l[0],l[2]=a*l[1]+l[2],l[h.type]},h.getMix=function(t){return l[t||h.type]}}function z(t,e,n,i){this.sampleRate=isNaN(t)?this.sampleRate:t,this.threshold=isNaN(e)?this.threshold:e,this.attack=isNaN(n)?this.attack:n,this.release=isNaN(i)?this.release:i,this._amplitude=new D.Amplitude(this.sampleRate,this.attack,this.release)}function T(t,e,i){function s(){r=m*l.cutoff/l.samplerate,a=1-r/(2*(l.resonance+.5/(1+r))+r-2),o=a*a,u=o+1-2*n.cos(r)*a}var r,a,o,u,f,h,l=this,c=0,p=0,m=2*n.PI;l.cutoff=e?e:2e4,l.resonance=i?i:1,l.samplerate=t,l.pushSample=function(t){return(f!==l.cutoff||h!==l.resonance)&&(s(),f=l.cutoff,h=l.resonance),c+=(t-p)*u,p+=c,c*=o,p},l.getMix=function(){return p},s()}function M(){this.reset.apply(this,arguments)}function O(t,e){var n=this;n.frequency=isNaN(e)?440:e,n.waveTable=new a(1),n.sampleRate=t,n.waveShapes=n.waveShapes.slice(0)}function L(t,e){var n=this;n.voices=[],n.sampleRate=t,n.pitch=isNaN(e)?440:n.pitch}function U(t,e,n){this.sampleRate=isNaN(t)?this.sampleRate:t,this.attack=isNaN(e)?this.attack:e,this.decay=isNaN(n)?this.decay:n}r.list=[];var q=e.Float32Array||s,D=this;D.Float32Array=a;var E=function(){return i.defineProperty?i.defineProperty:i.prototype.__defineGetter__?function(t,e,n){n.get&&t.__defineGetter__(e,n.get),n.set&&t.__defineSetter__(e,n.set)}:void 0}();o(D,"__define",E),o(D,"__defineConst",o),o(D,"__extend",u),o(D,"__enum",f),o(D,"__class",h),l.prototype={parameter:"",automation:null,amount:1,type:"modulation",mode:null,setType:function(t){t?("function"==typeof t&&(this.type=t.name||"custom",this.mode=t),this.type=t,this.mode=c.modes[t]):this.mode=this.mode||c.modes[this.type]}},c.generatorAppend=function(t,e,n){var i,s,r,a,o,u=this,f=t.length,h=u.automation.length,l=[];for(n=n||t,e=e||u.channelCount,a=0;h>a;a++)l.push(u[u.automation[a].parameter]);for(s=0,i=0;f>s;s+=e,i++){for(a=0;h>a;a++)u[u.automation[a].parameter]=l[a];for(a=0;h>a;a++)o=u.automation[a],o.mode(u,o.parameter,o.amount*o.automation.generatedBuffer[i]);for(u.generate(),r=0;e>r;r++)n[s+r]=u.getMix(r)*u.mix+t[s+r]}for(a=0;h>a;a++)u[u.automation[a].parameter]=l[a];return n},c.effectAppend=function(t,e,n){var i,s,r,a,o,u=this,f=t.length,h=u.automation.length,l=[];for(n=n||t,e=e||u.channelCount,a=0;h>a;a++)l.push(u[u.automation[a].parameter]);for(s=0,i=0;f>s;s+=e,i++){for(a=0;h>a;a++)u[u.automation[a].parameter]=l[a];for(a=0;h>a;a++)o=u.automation[a],o.mode(u,o.parameter,o.amount*o.automation.generatedBuffer[i]);for(r=0;e>r;r++)u.pushSample(t[s+r],r),n[s+r]=u.getMix(r)*u.mix+t[s+r]*(1-u.mix)}for(a=0;h>a;a++)u[u.automation[a].parameter]=l[a];return n},c.bufferEffectAppend=function(t,e,n){var i,s,r,a,o,u=this,f=e||u.channelCount,h=t.length,l=u.automation.length,c=[];for(n=n||t,r=0;l>r;r++)for(c.push([]),s=0;f>s;s++)c[r].push(u.effects[s][u.automation[r].parameter]);for(o=0,i=0;h>i;i+=f,o++)for(s=0;f>s;s++){for(r=0;l>r;r++)a=u.automation[r],u.effects[s][a.parameter]=c[r][s],a.mode(u.effects[s],a.parameter,a.amount*a.automation.generatedBuffer[o]);n[i+s]=u.effects[s].pushSample(t[i+s])*u.mix+t[i+s]*(1-u.mix)}for(r=0;l>r;r++)for(s=0;f>s;s++)u.effects[s][u.automation[r].parameter]=c[r][s];return n},c.modes={modulation:function(t,e,n){t.setParam(e,t[e]*n)},addition:function(t,e,n){t.setParam(e,t[e]+n)},subtraction:function(t,e,n){t.setParam(e,t[e]-n)},additiveModulation:function(t,e,n){t.setParam(e,t[e]+t[e]*n)},subtractiveModulation:function(t,e,n){t.setParam(e,t[e]-t[e]*n)},assignment:function(t,e,n){t.setParam(e,n)},absoluteAssignment:function(t,e,i){t.setParam(e,n.abs(i))}},c.__constructror=l,r(function(){D.BufferEffect.prototype.addAutomation=D.EffectClass.prototype.addAutomation=D.GeneratorClass.prototype.addAutomation=function(){return D.Automation.apply(D,[this].concat([].slice.call(arguments)))}}),p.prototype={mix:.5,type:"buffereffect",channelCount:2,append:function(t,e,n){var i,s,r=this,a=t.length;for(e=e||r.channelCount,n=n||t,i=0;a>i;i+=e)for(s=0;e>s;s++)r.effects[s].pushSample(t[i+s],0),n[i+s]=r.effects[s].getMix(0)*r.mix+t[i+s]*(1-r.mix);return n},addPreProcessing:function(){var t;for(t=0;t<this.effects.length;t++)this.effects[t].addPreProcessing.apply(this.effects[t],arguments)},removePreProcessing:function(){var t;for(t=0;t<this.effects.length;t++)this.effects[t].removePreProcessing.apply(this.effects[t],arguments)},setParam:function(t,e){var n,i=this.effects.length;for(n=0;i>n;n++)this.effects[n].setParam(t,e)}},r(function(){D.EffectClass.createBufferBased=function(t){return new D.BufferEffect(this,t,[].slice.call(arguments,1))}}),d.prototype={type:"effect",sink:!0,source:!0,mix:.5,channelCount:1,append:function(t,e,n){var i,s,r=t.length;for(n=n||t,e=e||this.channelCount,i=0;r>i;i+=e)for(s=0;e>s;s++)this.pushSample(t[i+s],s),n[i+s]=this.getMix(s)*this.mix+t[i+s]*(1-this.mix);return n},addPreProcessing:function(t){t.pushSample=this.pushSample,this.pushSample=function(){return t.apply(this,arguments),t.pushSample.apply(this,arguments)}},removePreProcessing:function(t){for(var e;e=this.pushSample.pushSample;)e!==t&&t||(this.pushSample=e,t.pushSample=null)},setParam:function(t,e){this[t]=e},pushSample:function(){},getMix:function(){},reset:function(){}},r(function(){function t(t,e,n,i){var r,a,o,u,f;e?i||e instanceof s||"object"!=typeof e||(i=e,e=[]):e=[],i=i||{},n=n||4096,"number"==typeof n?r=new Float64Array(n):(r=n,n=r.length),u=this.apply(D,e);for(f in i)i.hasOwnProperty(f)&&u.setParam(f,i[f]);return o=D.FFT(u.sampleRate||44100,n/2,!1),a=new Float64Array(n/2),t&&t(a),u.append(a,1),o._process(r,a,"real"),r}d.getFrequencyResponse=function(e,n,i){return t.call(this,function(t){t[0]=t.length/2},e,n,i)},g.getFrequencyResponse=function(e,n,i){return t.call(this,null,e,n,i)}}),g.prototype={type:"generator",source:!0,mix:1,generatedBuffer:null,channelCount:1,append:function(t,e,n){var i,s,r=t.length;for(n=n||t,e=e||this.channelCount,i=0;r>i;i+=e)for(this.generate(),s=0;e>s;s++)n[i+s]=this.getMix(s)*this.mix+t[i+s];return n},addPreProcessing:function(t){t.generate=this.generate,this.generate=function(){return t.apply(this,arguments),t.generate.apply(this,arguments)}},removePreProcessing:function(t){for(var e;e=this.generate.generate;)e!==t&&t||(this.generate=e,t.generate=null)},generateBuffer:function(t,e){this.generatedBuffer=new a(t),this.append(this.generatedBuffer,e||1)},setParam:function(t,e){this[t]=e},generate:function(){},getMix:function(){},reset:function(){}},o(v,"_pluginList",[],!1),y.prototype={sampleRate:44100,attack:50,decay:50,sustain:1,release:50,sustainTime:null,releaseTime:null,gate:!1,state:3,value:0,_st:0,generate:function(){return this.states[this.state].call(this),this.value},getMix:function(){return this.value},triggerGate:function(t){t="undefined"==typeof t?!this.gate:t,this.gate=t,this.state=t?0:null===this.releaseTime?3:5,this._st=0},states:[function(){this.value+=1e3/this.sampleRate/this.attack,this.value>=1&&(this.state=1)},function(){this.value-=1e3/this.sampleRate/this.decay*this.sustain,this.value<=this.sustain&&(null===this.sustainTime?this.state=2:(this._st=0,this.state=4))},function(){this.value=this.sustain},function(){this.value=n.max(0,this.value-1e3/this.sampleRate/this.release)},function(){this.value=this.sustain,this._st++>=.001*this.sampleRate*this.sustainTime&&(this._st=0,this.state=null===this.releaseTime?3:5)},function(){this.value=n.max(0,this.value-1e3/this.sampleRate/this.release),this._st++>=.001*this.sampleRate*this.releaseTime&&(this._st=0,this.state=0)}]},b.prototype={sampleRate:44100,stepLength:200,steps:null,attack:0,phase:0,value:0,generate:function(){var t,e,n,i,s,r=this,a=r.sampleRate/1e3*r.stepLength,o=r.steps,u=a*o.length;return r.phase=(r.phase+1)%u,t=r.phase/u*o.length,e=t%1,t=~~t,n=(t||o.length)-1,i=o[t]-o[n],s=o[t],e<r.attack&&(s-=i-i/r.attack*e),r.value=s,s},getMix:function(){return this.value},triggerGate:function(){this.phase=0}},w.prototype={sampleRate:44100,value:1,schedule:null,clock:0,getMix:function(){return this.value},generate:function(){var t;for(t=0;t<this.schedule.length;t++)this.schedule[t].t--&&(this.value=this.schedule[t].v,this.schedule.splice(t--,1))},setValue:function(t){this.schedule.push({v:t,t:~~((+new Date-this.clock)/1e3*this.sampleRate)})},reset:function(t){this.value=isNaN(t)?this.value:t,this.clock=+new Date}},S.BiquadFilterClass=function j(){var t;for(t in j.prototype)j.prototype.hasOwnProperty&&(this[t]=this[t])},S.BiquadFilterClass.prototype={sampleRate:44100,sample:0,inputs:null,outputs:null,coefs:null,pushSample:function(t){var e=this.coefs,n=this.inputs,i=this.outputs;return this.sample=e.b0*t+e.b1*n[0]+e.b2*n[1]-e.a1*i[0]-e.a2*i[1],n.pop(),n.unshift(t),i.pop(),i.unshift(this.sample),this.sample},getMix:function(){return this.sample},reset:function(t,e,n,i,s,r){this.inputs=[0,0],this.outputs=[0,0],this.sampleRate=isNaN(t)?this.sampleRate:t,arguments.length>1&&(this.coefs={b0:e,b1:n,b2:i,a1:s,a2:r})}},S.LowPass=function(t,e,i){var s=2*n.PI*e/t,r=n.cos(s),a=n.sin(s),o=a/(2*i),u=(1-r)/2,f=1-r,h=u,l=1+o,c=-2*r,p=1-o;this.reset(t,u/l,f/l,h/l,c/l,p/l)},S.HighPass=function(t,e,i){var s=2*n.PI*e/t,r=n.cos(s),a=n.sin(s),o=a/(2*i),u=(1+r)/2,f=-(1+r),h=u,l=1+o,c=-2*r,p=1-o;this.reset(t,u/l,f/l,h/l,c/l,p/l)},S.AllPass=function(t,e,i){var s=2*n.PI*e/t,r=n.cos(s),a=n.sin(s),o=a/(2*i),u=1-o,f=-2*r,h=1+o,l=h,c=f,p=u;this.reset(t,u/l,f/l,h/l,c/l,p/l)},S.BandPass=function(t,e,i){var s=2*n.PI*e/t,r=n.cos(s),a=n.sin(s),o=n.log(2)/2*i*s/a,u=a*(n.exp(o)-n.exp(-o))/2,f=u,h=0,l=-u,c=1+u,p=-2*r,m=1-u;this.reset(t,f/c,h/c,l/c,p/c,m/c)},function(t,e){for(e=0;e<t.length;e++)t[e].prototype=new S.BiquadFilterClass}([S,S.LowPass,S.HighPass,S.AllPass,S.BandPass]),C.prototype={sample:0,index:0,store:0,feedback:.84,damping:.2,pushSample:function(t){var e=this;return e.sample=e.buffer[e.index],e.store=e.sample*e.invDamping+e.store*e.damping,e.buffer[e.index++]=t+e.store*e.feedback,e.index>=e.bufferSize&&(e.index=0),e.sample},getMix:function(){return this.sample},reset:function(){this.index=this.store=0,this.samples=0,this.buffer=new a(this.bufferSize)},setParam:function(t,e){switch(t){case"damping":this.damping=e,this.invDamping=1-e;break;default:this[t]=e}}},P.prototype={sampleRate:44100,sample:0,pos:0,kernels:null,buffer:null,pushSample:function(t){var e,n,i;for(this.sample=0,this.buffer[this.pos]=t,n=0,i=this.buffer.length,e=this.pos+i;i>n;n++)this.sample+=this.kernels[n]*this.buffer[(e-n)%i];this.pos=(this.pos+1)%this.buffer.length},getMix:function(){return this.sample},setParam:function(t,e){switch(t){case"kernels":this.buffer=new a(e.length),this.pos=0}this[t]=e}},N.prototype={sampleRate:1,time:1e3,feedback:0,bufferPos:0,buffer:null,sample:0,_rstf:1,pushSample:function(t){var e=this,n=e.buffer;return n[e.bufferPos++]+=t,e.bufferPos>e.time*e._rstf&&(e.bufferPos=0),e.sample=n[e.bufferPos],n[e.bufferPos]*=e.feedback,e.sample},getMix:function(){return this.sample},resample:function(t){var e=this,i=e.time/t;return e.buffer=D.Sink.resample(e.buffer,t),e.time=t,e.bufferPos=n.round(i*e.bufferPos),e.buffer},reset:function(t,e){var i,s,r=this,o=r.buffer;if(t=isNaN(t)?r.sampleRate:t,s=r.sampleRate/t,r.buffer=new a(t*N.MAX_DELAY),r.bufferPos=n.round(s*r.bufferPos),r._rstf=.001*t,e)for(o=D.Sink.resample(o,s),i=0;i<o.length&&i<r.buffer.length;i++)r.buffer[i]=o[i];return r.buffer}},N.MAX_DELAY=2,B.prototype={channelCount:2,sample:[0,0],wet:.5,dry:.55,damping:.2223,roomSize:.5,tuning:{},pushSample:function(t,e){var n,i=t*this.tuning.fixedGain,s=0;for(n=0;n<this.numCFs;n++)s+=this.CFs[e][n].pushSample(i);for(n=0;n<this.numAPFs;n++)s=this.APFs[e][n].pushSample(s);this.sample[e]=s*this.wet+t*this.dry},getMix:function(t){return this.sample[t]},reset:function(){var t,e;for(e=0;e<this.channelCount;e++){for(t=0;t<this.numCFs;t++)this.CFs[e][t].reset();for(t=0;t<this.numAPFs;t++)this.APFs[e][t].reset();this.sample[e]=0}},setParam:function(t,e){var n,i,s,r;switch(t){case"roomSize":for(this.roomSize=e,n=this.roomSize*this.tuning.scaleRoom+this.tuning.offsetRoom,r=0;r<this.channelCount;r++)for(s=0;s<this.numCFs;s++)this.CFs[r][s].setParam("feedback",n);break;case"damping":for(this.damping=e,i=this.damping*this.tuning.scaleDamping,r=0;r<this.channelCount;r++)for(s=0;s<this.numCFs;s++)this.CFs[r][s].setParam("damping",i);break;default:this[t]=e}}},B.Tuning=function(t){var e;if(t)for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},B.Tuning.prototype={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.9,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},B.AllPassFilter=function(t,e,n){var i=this;i.sampleRate=t,i.buffer=new a(isNaN(e)?500:e),i.bufferSize=i.buffer.length,i.feedback=isNaN(n)?i.feedback:n},B.AllPassFilter.prototype={sample:0,index:0,feedback:.5,pushSample:function(t){var e=this;return bufOut=e.buffer[e.index],e.sample=-t+bufOut,e.buffer[e.index++]=t+bufOut*e.feedback,e.index>=e.bufferSize&&(e.index=0),e.sample},getMix:function(){return this.sample},reset:function(){this.index=0,this.sample=0,this.buffer=new a(this.bufferSize)}},F.prototype={sampleRate:44100,gain:1,sample:0,pushSample:function(t){return this.sample=t*this.gain,this.sample},getMix:function(){return this.sample}},z.prototype={sampleRate:44100,threshold:.95,attack:.01,release:.01,__amplitude:null,sample:0,pushSample:function(t){var e=this._amplitude.pushSample(t)-this.threshold;return this.sample=e>0?t/(1+e):t,this.sample},getMix:function(){return this.sample},setParam:function(t,e){switch(t){case"attack":case"release":this._amplitude[t]=e,this[t]=e;break;default:this[t]=e}}},M.prototype={sampleRate:44100,color:"white",b0:0,b1:0,b2:0,b3:0,b4:0,b5:0,c1:null,c2:null,c3:null,c4:null,q:15,q0:null,q1:null,brownQ:0,value:0,reset:function(t,e){this.sampleRate=isNaN(t)?this.sampleRate:t,this.color="string"==typeof e?e:this.color,this.c1=(1<<this.q)-1,this.c2=~~(this.c1/3)+1,this.c3=1/this.c1,this.c1=6*this.c2,this.c4=3*(this.c2-1),this.q0=n.exp(-200*n.PI/this.sampleRate),this.q1=1-this.q0},generate:function(){this.value=this[this.color]()},getMix:function(){return this.value},white:function(){var t=n.random();return(t*this.c1-this.c4)*this.c3},pink:function(){var t=this.white();return this.b0=.997*this.b0+.029591*t,this.b1=.985*this.b1+.032534*t,this.b2=.95*this.b2+.048056*t,this.b3=.85*this.b3+.090579*t,this.b4=.62*this.b4+.10899*t,this.b5=.25*this.b5+.255784*t,.55*(this.b0+this.b1+this.b2+this.b3+this.b4+this.b5)},brown:function(){var t=this.white();return this.brownQ=this.q1*t+this.q0*this.brownQ,6.2*this.brownQ}},function(t,e,i,s){for(i=O.prototype={sampleRate:44100,frequency:440,phaseOffset:0,pulseWidth:.5,fm:0,waveShape:"sine",phase:0,_p:0,generate:function(){var t=this,e=+t.frequency,n=t.pulseWidth,i=t.phase;e+=e*t.fm,t.phase=(i+e/t.sampleRate/2)%1,i=(t.phase+t.phaseOffset)%1,t._p=n>i?i/n:(i-n)/(1-n)},getMix:function(){return this[this.waveShape]()},getPhase:function(){return this._p},reset:function(t){this.phase=this._p=isNaN(t)?0:t},setWavetable:function(t){return this.waveTable=t,!0},sine:function(){return n.sin(this._p*t)},triangle:function(){return this._p<.5?4*this._p-1:3-4*this._p},square:function(){return this._p<.5?-1:1},sawtooth:function(){return 1-2*this._p},invSawtooth:function(){return 2*this._p-1},pulse:function(){return this._p<.5?this._p<.25?8*this._p-1:1-8*(this._p-.25):-1},wavetable:function(){return D.Sink.interpolate(this.waveTable,this._p*this.waveTable.length)},waveShapes:[]},s=0;s<e.length;s++)i[s]=i[e[s]],i.waveShapes.push(i[s]);O.WaveShape=function(t,e){return e&&(this.prototype[t]=e),this.prototype[t]},O.createMixWave=function(t,e){var n,i,s=e.length;return this.WaveShape(t,function(){for(n=0,i=0;s>i;i++)n+=this[e[i].shape]()*e[i].mix;return n})}}(2*n.PI,["sine","triangle","pulse","sawtooth","invSawtooth","square"]),L.prototype={sampleRate:44100,pitch:440,delayStart:0,delayEnd:0,maxVoices:1/0,sampleSize:0,voices:null,sample:null,samples:null,data:null,noteOn:function(t,e){t=isNaN(t)?this.pitch:t;var n=this,i=t/n.pitch,s=n.sampleRate,r=s*n.delayStart,a=n.sampleSize-s*n.delayEnd-1,o={f:t,p:r,s:i,l:a,v:isNaN(e)?1:e};for(n.voices.push(o);n.voices.length>n.maxVoices;)a=n.voices.shift(),a.onend&&a.onend();return o},generate:function(){var t,e,n=this.voices;for(t=0;t<n.length;t++)e=n[t],e.p+=e.s,e.p>e.l&&n.splice(t--,1)&&e.onend&&e.onend()},getMix:function(t){var e,n=this.voices,i=0;if(t=t||0,this.samples[t])for(e=0;e<n.length;e++)i+=D.Sink.interpolate(this.samples[t],n[e].p)*n[e].v;return i},load:function(t,e){var n,i=this,s=i.samples=D.Sink.deinterleave(t.data,t.channelCount);if(e)for(n=0;n<s.length;n++)s[n]=D.Sink.resample(s[n],t.sampleRate,i.sampleRate);i.sample=t.data,i.samples=s,i.data=t,i.sampleSize=s[0].length}},function(){function e(){var t,e,n=arguments,i=n.length;for(e=0;i>e;e++)t=n[e],this.postMessage({type:"injection",code:t instanceof Function?"("+String(t)+").call(this);":t})}D.AudioWorker=function(n,i){var s,r="var audioLib=("+String(t)+").call({},this,Math,Object,Array);\n";for(s=0;s<D.plugins._pluginList.length;s++)r+="("+String(D.plugins._pluginList[url])+"());\n";return i&&(r+='this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)},true);\n'),r+=n instanceof Function?"("+String(n)+").call(this);":n.textContent||n,r=I.inlineWorker(r),i&&(r.inject=e),r}}(),function(t,e){function n(t,e){return e?o(255&t)+n(t>>8,e-1):""}function i(t,e){return e?i(t>>8,e-1)+o(255-t&255):""}function s(t,e,s){return s?i(t,e):n(t,e)}function r(t,n){var i,s=t.length,r=s-1,a=0,o=e.pow;if(n)for(i=0;s>i;i++)a+=(255-t.charCodeAt(i))*o(256,r-i);else for(i=0;s>i;i++)a+=t.charCodeAt(i)*o(256,i);return a}function a(t,n,i,s){var r=e.pow,o=e.floor,u=a.convertFromBinary,f=a.convertToBinary,h=t/8,l=r(2,t),c=l/2,p=c-1,m=1/c,d=1/p;return s?i?n?function(t,e){return t=o(0>t?t*c+l:t*p),f(t,h,e)}:function(t,e){return f(o(t*p),h,e)}:n?function(t,e){return f(0>t?t+l:t,h,e)}:function(t,e){return f(t,h,e)}:i?n?function(t,e){var n=u(t,e);return n>p?(n-l)*m:n*d}:function(t,e){return u(t,e)*d}:n?function(t,e){var n=u(t,e);return n>p?n-l:n}:function(t,e){return u(t,e)}}var o=String.fromCharCode,u=!0,f=!1;a.convertToBinary=s,a.convertFromBinary=r,a.fromQ32=a(32,u,u,u),a.toQ32=a(32,u,u,f),a.fromQ24=a(24,u,u,u),a.toQ24=a(24,u,u,f),a.fromQ16=a(16,u,u,u),a.toQ16=a(16,u,u,f),a.fromQ8=a(8,u,u,u),a.toQ8=a(8,u,u,f),a.fromInt32=a(32,u,f,u),a.toInt32=a(32,u,f,f),a.fromInt16=a(16,u,f,u),a.toInt16=a(16,u,f,f),a.fromInt8=a(8,u,f,u),a.toInt8=a(8,u,f,f),a.fromUint32=a(32,f,f,u),a.toUint32=a(32,f,f,f),a.fromUint16=a(16,f,f,u),a.toUint16=a(16,f,f,f),a.fromUint8=a(8,f,f,u),a.toUint8=a(8,f,f,f),t.Binary=a}(this,n),function(t,e){function n(t){this.data=t}function i(t,e,n){var i=e/8;a["read"+t+e]=function(t){return n(this.read(i),t)}}var s,r,a=n.prototype={read:function(t){var e=this,n=e.data.substr(0,t);return e.skip(t),n},skip:function(t){var e=this,n=e.data=e.data.substr(t);return e.pointer+=t,n.length},readBuffer:function(t,e,n){for(var i=this,s="read"+n+e,r=t.length,a=0;i.data&&r>a;)t[a++]=i[s]();return a}};for(s in e)r=/to([a-z]+)([0-9]+)/i.exec(s),r&&i(r[1],r[2],e[s]);t.Stream=n,n.newType=i}(this,this.Binary),this.PCMData=function(t,e){function i(t){return("string"==typeof t?i.decode:i.encode)(t)}var r="undefined"==typeof Uint8Array?s:Uint8Array;return i.decodeFrame=function(t,n,i){if(8===n){var s=new r(i.length);for(new e(t).readBuffer(s,8,"Uint"),n=0;n<i.length;n++)i[n]=127.5*(s[n]-127.5)}else new e(t).readBuffer(i,n,"Q");return i},i.encodeFrame=function(e,n){var i,s=t[(8===n?"fromUint":"fromQ")+n],r=e.length,a="";if(8===n)for(i=0;r>i;i++)a+=s(127.5*e[i]+127.5);else for(i=0;r>i;i++)a+=s(e[i]);return a},i.decode=function(t,n){function s(){u=r.read(4),f=r.readUint32(),l=r.read(f),p=w[u]=w[u]||[],"data"===u?(h=~~(f/b),c=S.data=new a(h),i.decodeFrame(l,8*b,c)):p.push(l),n&&(r.data?setTimeout(s,1):n(S))}var r=new e(t),o=(r.read(4),r.readUint32());r=new e(r.read(o));var u,f,h,l,c,p,m=(r.read(4),r.read(4),r.readUint32()),d=new e(r.read(m)),g=(d.readUint16(),d.readUint16()),v=(d.readUint32(),d.readUint32()),y=d.readUint16(),b=y/g,w=(d.readUint16(),{}),S={channelCount:g,bytesPerSample:y/g,sampleRate:v/y,chunks:w,data:c};if(n)r.data?s():n(S);else for(;r.data;)s();return S},i.encode=function(e,s){var r,a,o,u,f=t.fromUint32,h=t.fromUint16,l=e.data,c=e.sampleRate,p=e.channelCount||1,m=e.bytesPerSample||1,d=8*m,g=p*m,v=c*g,y=l.length,b=y*m,w=(n.pow(2,d-1)-1,[]),S="";if(w.push("fmt "+f(16)+h(1)+h(p)+f(c)+f(v)+h(g)+h(d)),w.push("data"+f(b)+i.encodeFrame(l,d)),u=e.chunks)for(a in u)if(u.hasOwnProperty(a))for(r=u[a],o=0;o<r.length;o++)S=r[o],w.push(a+f(S.length)+S);return w=w.join(""),w="RIFF"+f(w.length)+"WAVE"+w,s&&setTimeout(function(){s(w)},1),w},i}(this.Binary,this.Stream);var I=this.Sink=function(t){function e(t,n,i,s){var r,a=e.sinks.list;for(r=0;r<a.length;r++)if(a[r].enabled)try{return new a[r](t,n,i,s)}catch(o){}throw e.Error(2)}function n(){}function i(t,n,s,r,a){s=s||n.prototype,n.prototype=new e.SinkClass,n.prototype.type=t,n.enabled=!r;var o;for(o in s)s.hasOwnProperty(o)&&(n.prototype[o]=s[o]);i[t]=n,i.list[a?"unshift":"push"](n)}return e.SinkClass=n,n.prototype=e.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,previousHit:0,ringOffset:0,channelMode:"interleaved",isReady:!1,start:function(t,n,i,s){this.channelCount=isNaN(n)||null===n?this.channelCount:n,this.bufferSize=isNaN(i)||null===i?this.bufferSize:i,this.sampleRate=isNaN(s)||null===s?this.sampleRate:s,this.readFn=t,this.activeRecordings=[],this.previousHit=+new Date,e.EventEmitter.call(this),e.emit("init",[this].concat([].slice.call(arguments)))},process:function(t,n){if(this.emit("preprocess",arguments),this.ringBuffer&&("interleaved"===this.channelMode?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments),"interleaved"===this.channelMode)this.emit("audioprocess",arguments),this.readFn&&this.readFn.apply(this,arguments);else{var i=e.deinterleave(t,this.channelCount),s=[i].concat([].slice.call(arguments,1));this.emit("audioprocess",s),this.readFn&&this.readFn.apply(this,s),e.interleave(i,this.channelCount,t)}this.emit("postprocess",arguments),this.previousHit=+new Date,this.writePosition+=t.length/n},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ready:function(){this.isReady||(this.isReady=!0,this.emit("ready",[]))}},e.sinks=e.devices=i,e.sinks.list=[],e.singleton=function(){var t=e.apply(null,arguments);return e.singleton=function(){return t},t},t.Sink=e,e}(function(){return this}());void function(t){function e(){var t;for(t in e.prototype)e.prototype.hasOwnProperty(t)&&(this[t]=e.prototype[t]);this._listeners={}}e.prototype={_listeners:null,emit:function(t,e){if(this._listeners[t])for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].apply(this,e);return this},on:function(t,e){return this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this},off:function(t,e){if(this._listeners[t]){if(!e)return delete this._listeners[t],this;for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n]===e&&this._listeners[t].splice(n--,1);this._listeners[t].length||delete this._listeners[t]}return this}},t.EventEmitter=e,e.call(t)}(this.Sink),void function(t){function e(t){if(!e.hasOwnProperty(t))throw e(1);if(!(this instanceof e))return new e(t);var n;for(n in e[t])e[t].hasOwnProperty(n)&&(this[n]=e[t][n]);this.code=t}e.prototype=new Error,e.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message},e[1]={message:"No such error code.",explanation:"The error code does not exist."},e[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser."},e[16]={message:"Buffer underflow.",explanation:"Trying to recover..."},e[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway."},e[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate."},t.Error=e}(this.Sink),void function(t){var e,n,i,s;void function(t,r){function a(t,e){var n,i=e.slice();for(n=i.shift();"undefined"!=typeof n;n=i.shift())if(n=Function("return typeof "+n+t+'=== "undefined" ? undefined : '+n+t)())return n}e=a("Blob",t),n=a("BlobBuilder",t),i=a("URL",r),s=a("btoa",[""])}(["","Moz","WebKit","MS"],["","webkit"]);var r=e&&i&&function(t,n){return i.createObjectURL(new e([t],{type:n}))},a=n&&i&&function(t,e){var s=new n;return s.append(t),i.createObjectURL(s.getBlob(e))},o=s&&function(t,e){return"data:"+e+";base64,"+s(t)},u=r||a||o;u&&(r&&(u.createBlob=r),a&&(u.createBlobBuilder=a),o&&(u.createData=o),e&&(u.Blob=e),n&&(u.BlobBuilder=n),i&&(u.URL=i),t.createDynURL=u,t.revokeDynURL=function(t){return"string"==typeof t&&0===t.indexOf("data:")?!1:i.revokeObjectURL(t)})}(this.Sink),void function(t){function e(){return s(this,"terminate",this._terminate),t.revokeDynURL(this._url),delete this._url,delete this._terminate,this.terminate()}function n(i){function r(t,i,r){try{var a=t(i,"text/javascript"),o=new Worker(a);return s(o,"_url",a),s(o,"_terminate",o.terminate),s(o,"terminate",e),n.type?o:(n.type=r,n.createURL=t,o)}catch(u){return null}}var a=t.createDynURL;if(!a)return null;var o;return n.createURL?r(n.createURL,i,n.type):(o=r(a.createBlob,i,"blob"))?o:(o=r(a.createBlobBuilder,i,"blobbuilder"))?o:o=r(a.createData,i,"data")}var s=i.defineProperty?function(t,e,n){i.defineProperty(t,e,{value:n,configurable:!0,writable:!0})}:function(t,e,n){t[e]=n};t.EventEmitter.call(n),n.test=function(){function t(t){n.ready||(n.ready=!0,n.working=t,n.emit("ready",[t]),n.off("ready"),t&&e&&e.terminate(),e=null)}n.ready=n.working=!1,n.type="",n.createURL=null;var e=n("this.onmessage=function(e){postMessage(e.data)}"),i="inlineWorker";e?(e.onmessage=function(e){t(e.data===i)},e.postMessage(i),setTimeout(function(){t(!1)},1e3)):setTimeout(function(){t(!1)},0)},t.inlineWorker=n,n.test()}(this.Sink),void function(t){t.doInterval=function(e,n){function i(i){t.inlineWorker.working&&!i?(s=t.inlineWorker('setInterval(function (){ postMessage("tic"); }, '+n+");"),s.onmessage=function(){e()},r=function(){s.terminate()}):(s=setInterval(e,n),r=function(){clearInterval(s)})}var s,r;return t.inlineWorker.ready?i():t.inlineWorker.on("ready",function(){i()}),function(){r?r():t.inlineWorker.ready||t.inlineWorker.on("ready",function(){
r&&r()})}}}(this.Sink),void function(t){t.sinks("audiodata",function(){function e(){if(h){if(n=l.mozWriteAudio(h),f+=n,n<h.length)return h=h.subarray(n);h=null}if(i=l.mozCurrentSampleOffset(),s=Number(i+(o!==i?u.bufferSize:u.preBufferSize)*u.channelCount-f),i===o&&u.emit("error",[t.Error(16)]),s>0||o===i){u.ready();try{r=new a(o===i?u.preBufferSize*u.channelCount:u.forceBufferSize&&s<2*u.bufferSize?2*u.bufferSize:s)}catch(e){return u.emit("error",[t.Error(18)]),void u.kill()}u.process(r,u.channelCount),n=u._audio.mozWriteAudio(r),n<r.length&&(h=r.subarray(n)),f+=n}o=i}var n,i,s,r,o,u=this,f=0,h=null,l=new Audio;u.start.apply(u,arguments),u.preBufferSize=isNaN(arguments[4])||null===arguments[4]?this.preBufferSize:arguments[4],l.mozSetup(u.channelCount,u.sampleRate),this._timers=[],this._timers.push(t.doInterval(function(){+new Date-u.previousHit>2e3&&(u._audio=l=new Audio,l.mozSetup(u.channelCount,u.sampleRate),f=0,u.emit("error",[t.Error(17)]))},1e3)),this._timers.push(t.doInterval(e,u.interval)),u._bufferFill=e,u._audio=l},{bufferSize:24576,preBufferSize:24576,forceBufferSize:!1,interval:100,kill:function(){for(;this._timers.length;)this._timers.shift()();this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}},!1,!0),t.sinks.moz=t.sinks.audiodata}(this.Sink),function(t,e){function n(t){var e=document.createElement("audio");return t&&(e.src=t),e}function i(){var t=this;t.currentFrame=n(),t.nextFrame=n(),t._onended=function(){t.samples+=t.bufferSize,t.nextClip()}}e=t.sinks,e("wav",function(){function i(){s._audio.hasNextFrame||(s.ready(),t.memcpy(f,0,u,0),s.process(u,s.channelCount),s._audio.setSource("data:audio/wav;base64,"+btoa(D.PCMData.encode({data:u,sampleRate:s.sampleRate,channelCount:s.channelCount,bytesPerSample:s.quality}))),s._audio.currentFrame.src||s._audio.nextClip())}var s=this,r=new e.wav.wavAudio,o="undefined"==typeof o?D.PCMData:o;s.start.apply(s,arguments);var u=new a(s.bufferSize*s.channelCount),f=new a(s.bufferSize*s.channelCount);if(!n().canPlayType("audio/wav; codecs=1")||!btoa)throw 0;s.kill=t.doInterval(i,40),s._bufferFill=i,s._audio=r},{quality:1,bufferSize:22050,getPlaybackTime:function(){var t=this._audio;return(t.currentFrame?t.currentFrame.currentTime*this.sampleRate:0)+t.samples}}),i.prototype={samples:0,nextFrame:null,currentFrame:null,_onended:null,hasNextFrame:!1,nextClip:function(){var t=this.currentFrame;this.currentFrame=this.nextFrame,this.nextFrame=t,this.hasNextFrame=!1,this.currentFrame.play()},setSource:function(t){this.nextFrame.src=t,this.nextFrame.addEventListener("ended",this._onended,!0),this.hasNextFrame=!0}},e.wav.wavAudio=i}(this.Sink),void function(t){var e;try{e=require("cubeb")}catch(n){return}var i=function(){var t;return function(){return t=new e.Context("sink.js "+process.pid+" "+new Date),i=function(){return t},t}}(),s=0;t.sinks("cubeb",function(){var t=this;t.start.apply(t,arguments),t._ctx=i(),t._stream=new e.Stream(t._ctx,t._ctx.name+" "+s++,e.SAMPLE_FLOAT32LE,t.channelCount,t.sampleRate,t.bufferSize,t._latency,function(e){var n=new Buffer(4*e*t.channelCount),i=new a(n);t.process(i,t.channelCount),t._stream.write(n),t._stream.release()},function(t){}),t._stream.start()},{_ctx:null,_stream:null,_latency:250,bufferSize:4096,kill:function(){this._stream.stop(),this.emit("kill")}})}(this.Sink),void function(t){t.sinks("dummy",function(){function e(){var t=new a(n.bufferSize*n.channelCount);n.process(t,n.channelCount)}var n=this;n.start.apply(n,arguments),n._kill=t.doInterval(e,n.bufferSize/n.sampleRate*1e3),n._callback=e},{kill:function(){this._kill(),this.emit("kill")}},!0)}(this.Sink),function(t,e){var n="undefined"==typeof window?null:window.webkitAudioContext||window.AudioContext;t("webaudio",function(n,i,r,o){function u(t){var e,n,i=t.outputBuffer,r=i.numberOfChannels,o=i.length,u=(i.size,new s(r));for(f.ready(),c=c&&c.length===o*r?c:new a(o*r),p=p&&p.length===c.length?p:new a(o*r),c.set(p),e=0;r>e;e++)u[e]=i.getChannelData(e);for(f.process(c,f.channelCount),e=0;o>e;e++)for(n=0;r>n;n++)u[n][e]=c[e*f.channelCount+n]}var f=this,h=t.webaudio.getContext(),l=null,c=null,p=null;f.start.apply(f,arguments),l=h.createJavaScriptNode(f.bufferSize,f.channelCount,f.channelCount),f.sampleRate=h.sampleRate,l.onaudioprocess=u,l.connect(h.destination),f._context=h,f._node=l,f._callback=u,e.push(l)},{kill:function(){this._node.disconnect(0);for(var t=0;t<e.length;t++)e[t]===this._node&&e.splice(t--,1);this._node=this._context=null,this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate}},!1,!0),t.webkit=t.webaudio,t.webaudio.fix82795=e,t.webaudio.getContext=function(){var e=new n;return t.webaudio.getContext=function(){return e},e}}(this.Sink.sinks,[]),function(t){t.sinks("worker",function(){function t(t){n.isReady||n.initMSP(t),n.ready();var e,i,s=n.channelCount,f=t.audioLength;for(r=r&&r.length===f*s?r:new a(f*s),o=o&&o.length===r.length?o:new a(f*s),u=u&&u.length===r.length?u:new a(f*s),r.set(u),o.set(u),n.process(r,n.channelCount),e=0;s>e;e++)for(i=0;f>i;i++)o[e*t.audioLength+i]=r[e+i*s];t.writeAudio(o)}function e(t){n.isReady||n.initWA(t),n.ready();var e,i,o=t.outputBuffer,f=o.numberOfChannels,h=o.length,l=(o.size,new s(f));for(r=r&&r.length===h*f?r:new a(h*f),u=u&&u.length===r.length?u:new a(h*f),r.set(u),e=0;f>e;e++)l[e]=o.getChannelData(e);for(n.process(r,n.channelCount),e=0;h>e;e++)for(i=0;f>i;i++)l[i][e]=r[e*n.channelCount+i]}var n=this,i=function(){return this}(),r=null,o=null,u=null;n.start.apply(n,arguments),importScripts(),i.onprocessmedia=t,i.onaudioprocess=e,n._mspBufferFill=t,n._waBufferFill=e},{ready:!1,initMSP:function(t){this.channelCount=t.audioChannels,this.sampleRate=t.audioSampleRate,this.bufferSize=t.audioLength*this.channelCount,this.ready=!0,this.emit("ready",[])},initWA:function(t){var e=t.outputBuffer;this.channelCount=e.numberOfChannels,this.sampleRate=e.sampleRate,this.bufferSize=e.length*this.channelCount,this.ready=!0,this.emit("ready",[])}})}(this.Sink),function(t){!function(){function e(n,i){return n&&i?e[n]=i:n&&e[n]instanceof Function&&(t.interpolate=e[n]),e[n]}t.interpolation=e,e("linear",function(t,e){var i=n.floor(e),s=i+1,r=e-i;return s=s<t.length?s:0,t[i]*(1-r)+t[s]*r}),e("nearest",function(t,e){return e>=t.length-.5?t[0]:t[n.round(e)]}),e("linear")}(),t.resample=function(e,i,s,r,o){var u,f,h=arguments.length,l=2===h?i:3===h?i/s:r/i*o/s,c=e.length,p=n.ceil(c/l),m=new a(p);for(u=0,f=0;c>u;u+=l)m[f++]=t.interpolate(e,u);return m}}(this.Sink),function(t){t.deinterleave=function(t,e){var n,i,s=t.length,r=s/e,o=[];for(n=0;e>n;n++)for(o[n]=new a(r),i=0;r>i;i++)o[n][i]=t[i*e+n];return o},t.interleave=function(t,e,n){e=e||t.length;var i,s,r=t[0].length,o=t.length;for(n=n||new a(r*e),i=0;o>i;i++)for(s=0;r>s;s++)n[i+s*e]=t[i][s];return n},t.mix=function(t){var e,i,s,r=[].slice.call(arguments,1);for(s=0;s<r.length;s++)for(e=n.max(t.length,r[s].length),i=0;e>i;i++)t[i]+=r[s][i];return t},t.resetBuffer=function(t){var e,n=t.length;for(e=0;n>e;e++)t[e]=0;return t},t.clone=function(t,e){var n,i=t.length;for(e=e||new a(i),n=0;i>n;n++)e[n]=t[n];return e},t.createDeinterleaved=function(t,e){var n,i=new s(e);for(n=0;e>n;n++)i[n]=new a(t);return i},t.memcpy=function(t,e,n,i,s){if(t=t.subarray||t.slice?t:t.buffer,n=n.subarray||n.slice?n:n.buffer,t=e?t.subarray?t.subarray(e,s&&e+s):t.slice(e,s&&e+s):t,n.set)n.set(t,i);else for(var r=0;r<t.length;r++)n[r+i]=t[r];return n},t.memslice=function(t,e,n){return t.subarray?t.subarray(e,n):t.slice(e,n)},t.mempad=function(e,n,i){return n=n.length?n:new e.constructor(n),t.memcpy(e,0,n,i),n},t.linspace=function(t,e,n){var i,r,a,o;for(n=n.length?(i=n.length)&&n:s(i=n),o=(e-t)/--i,a=t+o,r=1;i>r;r++,a+=o)n[r]=a;return n[0]=t,n[i]=e,n},t.ftoi=function(t,e,i){var s,r=n.pow(2,e-1);for(i=i||new t.constructor(t.length),s=0;s<t.length;s++)i[s]=~~(r*t[s]);return i}}(this.Sink),function(t){function e(e,n){t.EventEmitter.call(this),this.bufferSize=isNaN(e)||null===e?this.bufferSize:e,this.channelCount=isNaN(n)||null===n?this.channelCount:n;var i=this;this.callback=function(){return i.process.apply(i,arguments)},this.resetBuffer()}e.prototype={buffer:null,zeroBuffer:null,parentSink:null,bufferSize:4096,channelCount:2,offset:null,resetBuffer:function(){this.buffer=new a(this.bufferSize),this.zeroBuffer=new a(this.bufferSize)},process:function(t,e){null===this.offset&&this.loadBuffer();for(var n=0;n<t.length;n++)this.offset>=this.buffer.length&&this.loadBuffer(),t[n]=this.buffer[this.offset++]},loadBuffer:function(){this.offset=0,t.memcpy(this.zeroBuffer,0,this.buffer,0),this.emit("audioprocess",[this.buffer,this.channelCount])}},t.Proxy=e,t.prototype.createProxy=function(e){var n=new t.Proxy(e,this.channelCount);return n.parentSink=this,this.on("audioprocess",n.callback),n}}(this.Sink),void function(t){function e(){this.ringBuffer&&("interleaved"===this.channelMode?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments)}t.on("init",function(t){t.on("preprocess",e)}),t.prototype.ringBuffer=null,t.prototype.ringSpin=function(t){var e,n=this.ringBuffer,i=t.length,s=n.length,r=this.ringOffset;for(e=0;i>e;e++)t[e]+=n[r],r=(r+1)%s;this.ringOffset=r},t.prototype.ringSpinDeinterleaved=function(t){var e,n,i=this.ringBuffer,s=t.length,r=i.length,a=i[0].length,o=this.ringOffset;for(e=0;s>e;e+=r){for(n=0;r>n;n++)t[e+n]+=i[n][o];o=(o+1)%a}this.ringOffset=n}}(this.Sink),void function(t,e){e=t.prototype,t.on("init",function(t){t.asyncBuffers=[],t.syncBuffers=[],t.on("preprocess",t.writeBuffersSync),t.on("postprocess",t.writeBuffersAsync)}),e.writeMode="async",e.asyncBuffers=e.syncBuffers=null,e.writeBuffersAsync=function(t){var e,i,s,r,a,o=this.asyncBuffers,u=t.length;if(o)for(s=0;s<o.length;s++){for(e=o[s],i=e.b.length,a=e.d,e.d-=n.min(a,u),r=0;u>r+a&&i>r;r++)t[r+a]+=e.b[r];e.b=e.b.subarray(r+a),s>=i&&o.splice(s--,1)}},e.writeBuffersSync=function(t){for(var e=this.syncBuffers,n=t.length,i=0,s=0;n>i&&e.length;i++)t[i]+=e[0][s],e[0].length<=s?(e.splice(0,1),s=0):s++;e.length&&(e[0]=e[0].subarray(s))},e.writeBufferAsync=function(e,n){e="deinterleaved"===this.mode?t.interleave(e,this.channelCount):e;var i=this.asyncBuffers;return i.push({b:e,d:isNaN(n)?~~((+new Date-this.previousHit)/1e3*this.sampleRate):n}),i.length},e.writeBufferSync=function(e){e="deinterleaved"===this.mode?t.interleave(e,this.channelCount):e;var n=this.syncBuffers;return n.push(e),n.length},e.writeBuffer=function(){return this["async"===this.writeMode?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},e.getSyncWriteOffset=function(){var t,e=this.syncBuffers,n=0;for(t=0;t<e.length;t++)n+=e[t].length;return n}}(this.Sink),void function(t){function e(t){this.boundTo=t,this.buffers=[],t.activeRecordings.push(this)}t.on("init",function(t){t.activeRecordings=[],t.on("postprocess",t.recordData)}),t.prototype.activeRecordings=null,t.prototype.record=function(){var e=new t.Recording(this);return this.emit("record",[e]),e},t.prototype.recordData=function(t){var e,n=this.activeRecordings,i=n.length;for(e=0;i>e;e++)n[e].add(t)},e.prototype={add:function(t){this.buffers.push(t)},clear:function(){this.buffers=[]},stop:function(){var t,e=this.boundTo.activeRecordings;for(t=0;t<e.length;t++)e[t]===this&&e.splice(t--,1)},join:function(){var t,e,n,i=0,s=0,r=this.buffers,o=r.length;for(n=0;o>n;n++)i+=r[n].length;for(t=new a(i),n=0;o>n;n++){for(e=0;e<r[n].length;e++)t[s+e]=r[n][e];s+=r[n].length}return t}},t.Recording=e}(this.Sink),U.prototype={sampleRate:44100,attack:.01,release:.01,sample:0,pushSample:function(t){return this.sample=n.abs((t>this.sample?this.attack:this.release)*(this.sample-t)+t),this.sample},getMix:function(){return this.sample}};var W=function(){"use strict";function t(t,e,n,i,s,r){for(var a=s.twiddle,o=0;r>o;o++){var u=t[2*(e+n*o)],f=t[2*(e+n*o)+1],h=t[2*(e+n*(o+r))],l=t[2*(e+n*(o+r))+1],c=a[2*(0+i*o)],p=a[2*(0+i*o)+1],m=h*c-l*p,d=h*p+l*c,g=u+m,v=f+d,y=u-m,b=f-d;t[2*(e+n*o)]=g,t[2*(e+n*o)+1]=v,t[2*(e+n*(o+r))]=y,t[2*(e+n*(o+r))+1]=b}}function e(t,e,n,i,s,r){for(var a=s.twiddle,o=r,u=2*r,f=i,h=2*i,l=a[2*(0+i*r)+1],c=0;r>c;c++){var p=t[2*(e+n*c)],m=t[2*(e+n*c)+1],d=t[2*(e+n*(c+o))],g=t[2*(e+n*(c+o))+1],v=a[2*(0+f*c)],y=a[2*(0+f*c)+1],b=d*v-g*y,w=d*y+g*v,S=t[2*(e+n*(c+u))],_=t[2*(e+n*(c+u))+1],k=a[2*(0+h*c)],C=a[2*(0+h*c)+1],R=S*k-_*C,P=S*C+_*k,N=b+R,x=w+P,B=p+N,F=m+x;t[2*(e+n*c)]=B,t[2*(e+n*c)+1]=F;var A=p-.5*N,z=m-.5*x,T=(b-R)*l,M=(w-P)*l,O=A-M,L=z+T;t[2*(e+n*(c+o))]=O,t[2*(e+n*(c+o))+1]=L;var U=A+M,q=z-T;t[2*(e+n*(c+u))]=U,t[2*(e+n*(c+u))+1]=q}}function i(t,e,n,i,s,r){for(var a,o,u,f,h=s.twiddle,l=r,c=2*r,p=3*r,m=i,d=2*i,g=3*i,v=0;r>v;v++){var y=t[2*(e+n*v)],b=t[2*(e+n*v)+1],w=t[2*(e+n*(v+l))],S=t[2*(e+n*(v+l))+1],_=h[2*(0+m*v)],k=h[2*(0+m*v)+1],C=w*_-S*k,R=w*k+S*_,P=t[2*(e+n*(v+c))],N=t[2*(e+n*(v+c))+1],x=h[2*(0+d*v)],B=h[2*(0+d*v)+1],F=P*x-N*B,A=P*B+N*x,z=t[2*(e+n*(v+p))],T=t[2*(e+n*(v+p))+1],M=h[2*(0+g*v)],O=h[2*(0+g*v)+1],L=z*M-T*O,U=z*O+T*M,q=y+F,D=b+A,E=y-F,I=b-A,W=C+L,j=R+U,Q=C-L,G=R-U,H=q+W,V=D+j;s.inverse?(a=E-G,o=I+Q):(a=E+G,o=I-Q);var Y=q-W,X=D-j;s.inverse?(u=E+G,f=I-Q):(u=E-G,f=I+Q),t[2*(e+n*v)]=H,t[2*(e+n*v)+1]=V,t[2*(e+n*(v+l))]=a,t[2*(e+n*(v+l))+1]=o,t[2*(e+n*(v+c))]=Y,t[2*(e+n*(v+c))+1]=X,t[2*(e+n*(v+p))]=u,t[2*(e+n*(v+p))+1]=f}}function s(t,e,n,i,s,r,a){for(var o,u,f,h,l=s.twiddle,c=s.n,p=new Float64Array(2*a),m=0;r>m;m++){for(o=0,h=m;a>o;o++,h+=r)u=t[2*(e+n*h)],f=t[2*(e+n*h)+1],p[2*o]=u,p[2*o+1]=f;for(o=0,h=m;a>o;o++,h+=r){var d=0;u=p[0],f=p[1],t[2*(e+n*h)]=u,t[2*(e+n*h)+1]=f;for(var g=1;a>g;g++){d=(d+i*h)%c;var v=t[2*(e+n*h)],y=t[2*(e+n*h)+1],b=p[2*g],w=p[2*g+1],S=l[2*d],_=l[2*d+1],k=b*S-w*_,C=b*_+w*S,R=v+k,P=y+C;t[2*(e+n*h)]=R,t[2*(e+n*h)+1]=P}}}}function r(n,a,o,u,f,h,l,c,p){var m,d,g,v=c.shift(),y=c.shift();if(1==y)for(m=0;v*y>m;m++)d=u[2*(f+h*l*m)],g=u[2*(f+h*l*m)+1],n[2*(a+o*m)]=d,n[2*(a+o*m)+1]=g;else for(m=0;v>m;m++)r(n,a+o*m*y,o,u,f+m*h*l,h*v,l,c.slice(),p);switch(v){case 2:t(n,a,o,h,p,y);break;case 3:e(n,a,o,h,p,y);break;case 4:i(n,a,o,h,p,y);break;default:s(n,a,o,h,p,y,v)}}function a(t,e,n){var i=[].slice.call(arguments);i[0]=this.sampleRate=isNaN(t)||null===t?this.sampleRate:t,i[1]=this.bufferSize=isNaN(e)||null===e?this.bufferSize:e,i[2]=!!n,this.__super.apply(this,i.slice(1))}var o=function(t,e){if(arguments.length<2)throw new RangeError("You didn't pass enough arguments, passed `"+arguments.length+"'");if(t=~~t,e=!!e,1>t)throw new RangeError("n is outside range, should be positive integer, was `"+t+"'");this.inputBuffer=new Float64Array(2*t),this.outputBuffer=new Float64Array(2*t);var i,s,r={n:t,inverse:e,factors:[],twiddle:new Float64Array(2*t),scratch:new Float64Array(2*t)},a=r.twiddle,o=2*n.PI/t;for(i=0;t>i;i++)s=e?o*i:-o*i,a[2*i]=n.cos(s),a[2*i+1]=n.sin(s);for(var u=4,f=n.floor(n.sqrt(t));t>1;){for(;t%u;){switch(u){case 4:u=2;break;case 2:u=3;break;default:u+=2}u>f&&(u=t)}t/=u,r.factors.push(u),r.factors.push(t)}this.state=r,this.resetFT()};return o.prototype.process=function(t,e,n){this.process_explicit(t||this.outputBuffer,0,1,e||this.inputBuffer,0,1,n)},o.prototype.process_explicit=function(t,e,n,i,s,a,o){var u,f,h;n=~~n,a=~~a,o=o||this.inputType;var l="real"===o?o:"complex";if(1>n)throw new RangeError("outputStride is outside range, should be positive integer, was `"+n+"'");if(1>a)throw new RangeError("inputStride is outside range, should be positive integer, was `"+a+"'");if("real"==l){for(u=0;u<this.state.n;u++)f=i[s+a*u],h=0,this.state.scratch[2*u]=f,this.state.scratch[2*u+1]=h;r(t,e,n,this.state.scratch,0,1,1,this.state.factors.slice(),this.state)}else if(i==t)for(r(this.state.scratch,0,1,i,s,1,a,this.state.factors.slice(),this.state),u=0;u<this.state.n;u++)f=this.state.scratch[2*u],h=this.state.scratch[2*u+1],t[2*(e+n*u)]=f,t[2*(e+n*u)+1]=h;else r(t,e,n,i,s,1,a,this.state.factors.slice(),this.state)},o.prototype.__super=o,a.prototype=o.prototype,a.prototype.inputType="real",a.prototype.sampleRate=44100,a.prototype.bufferSize=4096,a.prototype.resetFT=function(t){this.inputBuffer=new Float64Array(2*this.bufferSize),this.outputBuffer=new Float64Array(2*this.bufferSize),this.spectrum=new Float64Array(this.bufferSize/2),this.bandWidth=this.sampleRate/this.bufferSize/2,this.peakBand=0,this.peak=0,this.sample=0,this.offset=0,this.maxOffset="real"===this.inputType?this.bufferSize:2*this.bufferSize,this.pushSample=this._pushSample},a.prototype.pushSample=function(t){return this.resetFT(),this.pushSample(t)},a.prototype._pushSample=function(t){return this.inputBuffer[this.offset]=t,this.sample=t,this.offset=(this.offset+1)%this.maxOffset,this.offset||this.process(),t},a.prototype.getMix=function(){return this.sample},a.prototype.getBandFrequency=function(t){return this.bandWidth*t+.5*this.bandWidth},a.prototype.calculateSpectrum=function(){var t,e,i,s,r,a=(this.spectrum,this.outputBuffer),o=2/this.bufferSize,u=this.bufferSize/2;for(t=0,e=2;u>t;t++,e+=2)i=a[e+0],s=a[e+1],r=o*n.sqrt(i*i+s*s),r>this.peak&&(this.peakBand=t,this.peak=r),this.spectrum[t]=r},a.prototype._process=a.prototype.process,a.prototype.process=function(){this._process.apply(this,arguments),this.calculateSpectrum()},a}();for(D.ADSREnvelope=y,D.StepSequencer=b,D.UIControl=w,D.BiquadFilter=S,D.BitCrusher=_,D.Chorus=k,D.CombFilter=C,D.Compressor=R,D.Convolution=P,D.Delay=N,D.Distortion=x,D.GainController=F,D.IIRFilter=A,D.LP12Filter=T,D.Limiter=z,D.Reverb=B,D.Noise=M,D.Oscillator=O,D.Sampler=L,D.Amplitude=U,D.FFT=W,D.AudioDevice=D.Sink=function(){return this}().Sink,D.Automation=c,D.BufferEffect=p,D.EffectClass=d,D.GeneratorClass=g,D.codecs=D.Codec=m,D.plugins=v;r.list.length;)r.list.shift().call(D);return r=null,void function(t,e){function n(t,e,i,s){var r,a;if(e){i=i||e.prototype,r=e.prototype=new d,r.name=r.fxid=t,n[t]=h(t,e,s);for(a in i)i.hasOwnProperty(a)&&(r[a]=i[a]);for(a in d)"prototype"!==a&&d.hasOwnProperty(a)&&(n[t][a]=d[a])}return n[t]}for(D.effects=n,e=0;e<t.length;e++)D[t[e]]=n(t[e],D[t[e]],D[t[e]].prototype);n("BiquadAllPassFilter",S.AllPass),n("BiquadBandPassFilter",S.BandPass),n("BiquadHighPassFilter",S.HighPass),n("BiquadLowPassFilter",S.LowPass),n("FreeverbAllPassFilter",B.AllPassFilter)}(["BiquadFilter","BitCrusher","Chorus","CombFilter","Compressor","Convolution","Delay","Distortion","GainController","IIRFilter","LP12Filter","Limiter","Reverb","Amplitude","FFT"]),void function(t,e){function n(t,e,i,s){var r,a;if(e){i=i||e.prototype,r=e.prototype=new g,r.name=r.fxid=t,n[t]=h(t,e,s);for(a in i)i.hasOwnProperty(a)&&(r[a]=i[a]);for(a in g)"prototype"!==a&&g.hasOwnProperty(a)&&(n[t][a]=g[a])}return n[t]}for(D.generators=n,e=0;e<t.length;e++)D[t[e]]=n(t[e],D[t[e]],D[t[e]].prototype)}(["Noise","Oscillator","Sampler","ADSREnvelope","StepSequencer","UIControl"]),m("wav",D.PCMData),D.version="0.6.6",D}.call("undefined"==typeof exports?{}:this,this.window||global,Math,Object,Array);